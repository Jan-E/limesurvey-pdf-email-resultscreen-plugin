<div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.2.0.min.js"></script>
  <!--LIMESURVEY 2.5 USES BOOTSTRAP (DONT KNOW ABOUT OTHER VERSIONS) SO YOU CAN USE BOOTSTRAP!! -->
  <div class='container'>
    <div class='row'>
      <div class='col-md-6'>
        <h1>Relative Likes</h1>
        <p id='ice'></p>
        <p id='cheese'></p> 
        <p id='veggies'></p>
      </div>

      <div class='col-md-6'>
        <div id="svgcontainter" text-align="center">
          <div id="svg"></div> 
        </div>
      </div>
    </div>
  </div>
  <script> 
  //just set vars once and reuse;
  var screenwidth = screen.width;

  var w = '100%';

  var ice = parseInt( {!-likesicecream-!} );
  var cheese  = parseInt( {!-likescheese-!} );
  var veggies = parseInt( {!-likesveggies-!} );

  var total = ice + cheese + veggies;

  document.getElementById("ice").innerHTML = 'Likes IceCream: '+ (ice/total) * 100 + ' %';
  document.getElementById("cheese").innerHTML = 'Likes Cheese: '+ (cheese/total) * 100 + ' %';
  document.getElementById("veggies").innerHTML = 'Likes Veggies: '+ (veggies/total) * 100 + ' %';

   var data = [
    { "Word": "Likes Icecream", "Likes": ice }, 
    { "Word": "Likes cheese", "Likes": cheese }, 
    { "Word": "Likes Veggies", "Likes": veggies }, 
    ];
  var svg = dimple.newSvg("#svg",w, w); 
  var chart = new dimple.chart(svg, data); 
  chart.addMeasureAxis("p", "Likes"); 
  var ring = chart.addSeries("Word", dimple.plot.pie); ring.innerRadius = "50%"; 
  ring.afterDraw = function(shape, data) {
    var g = svg.select("g"); 
    var grect = g.node().getBBox(); var gmidx = grect.x + (grect.width - 7)/2; var gmidy = grect.y + (grect.height - 7)/2; var radius = (grect.height - 7) / 2; 
    var srect = d3.select(shape).node().getBBox(); 
    var smidx = srect.x + srect.width/2; 
    var smidy = srect.y + srect.height/2; 
    var dirx = smidx; var diry = smidy; 
    var norm = Math.sqrt(dirx * dirx + diry * diry); dirx /= norm; diry /= norm;
    var x = Math.round(gmidx + (radius + 25) * dirx);
    var y = Math.round(gmidy + (radius + 15) * diry); 
    var xOnPie = Math.round(gmidx + (radius+4) * dirx); 
    var yOnPie = Math.round(gmidy + (radius+4) * diry); 
    var node = 
    svg.append("text") 
      .attr("x", x + ((dirx > 0) ? 5 : -5))
      .attr("y", y + 3) .style("font-size", "12px")
      .style("font-family", "sans-serif")
      .style("text-anchor", (dirx > 0) ? "start" : "end")
      .style("fill", "black")
      .text(data.aggField[0]); 
    svg.append("line")
      .attr("x1", x)
      .attr("y1", y)
      .attr("x2", xOnPie)
      .attr("y2", yOnPie)
      .style("stroke", "#e0e0e0");
  };
   
  chart.draw();

  window.onresize = function () {
    screenwidth = screen.width;
    node.remove('text');
    node.remove('line');
    chart.draw(0, true);
  };
  </script>
</div> 
